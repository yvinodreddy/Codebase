<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† ULTRATHINK Real-Time Dashboard - v2.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #141B2D;
            --bg-card: #1a2233;
            --bg-card-hover: #232e45;
            --text-primary: #e6e9f0;
            --text-secondary: #a0a7b8;
            --accent-blue: #4a9eff;
            --accent-green: #4ade80;
            --accent-orange: #ff9836;
            --accent-red: #ff4757;
            --accent-purple: #9b59b6;
            --border-color: #2d3748;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #0d1321 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ============================================
           SYSTEM MONITOR BAR - Top of Screen
           ============================================ */
        .system-monitor {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: linear-gradient(135deg, #1a2233 0%, #0f1419 100%);
            padding: 12px 20px;
            border-bottom: 2px solid var(--accent-blue);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .system-monitor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .monitor-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .monitor-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .monitor-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-green);
        }

        .progress-bar-container {
            width: 100%;
            height: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 6px;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
            transition: width 0.5s ease, background 0.3s ease;
            border-radius: 5px;
        }

        .progress-bar-fill.high {
            background: linear-gradient(90deg, var(--accent-orange), var(--accent-red));
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.2);
            font-size: 0.8rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.connected { background: var(--success); }
        .status-dot.connecting { background: var(--warning); }
        .status-dot.disconnected { background: var(--error); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ============================================
           MAIN HEADER
           ============================================ */
        .header {
            padding: 30px 20px 20px;
            text-align: center;
            background: linear-gradient(180deg, rgba(74, 158, 255, 0.1) 0%, transparent 100%);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* ============================================
           TABS NAVIGATION
           ============================================ */
        .tabs-container {
            max-width: 1600px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0;
            overflow-x: auto;
        }

        .tab-button {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab-button:hover {
            color: var(--accent-blue);
            background: rgba(74, 158, 255, 0.1);
        }

        .tab-button.active {
            color: var(--accent-blue);
            border-bottom-color: var(--accent-blue);
            font-weight: 600;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ============================================
           TRACK CARDS - with View Details Button
           ============================================ */
        .tracks-container {
            max-width: 1600px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .tracks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .track-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .track-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-blue);
            transition: width 0.3s ease;
        }

        .track-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(74, 158, 255, 0.3);
            border-color: var(--accent-blue);
        }

        .track-card:hover::before {
            width: 8px;
        }

        .track-card.status-running::before { background: var(--success); }
        .track-card.status-completed::before { background: var(--accent-blue); }
        .track-card.status-failed::before { background: var(--error); }

        .track-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .track-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .track-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .track-status.running {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .track-status.completed {
            background: rgba(74, 158, 255, 0.2);
            color: var(--accent-blue);
        }

        .track-status.failed {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .track-progress {
            margin: 15px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .track-task {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 10px 0;
            min-height: 40px;
        }

        .track-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 158, 255, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* ============================================
           MODAL SYSTEM - Comprehensive Track Details
           ============================================ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 2000;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            max-width: 1400px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, transparent 100%);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--accent-red);
            transform: rotate(90deg);
        }

        .modal-tabs {
            display: flex;
            gap: 5px;
            padding: 15px 30px 0;
            border-bottom: 2px solid var(--border-color);
            overflow-x: auto;
            background: var(--bg-card);
        }

        .modal-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .modal-tab:hover {
            color: var(--accent-blue);
            background: rgba(74, 158, 255, 0.1);
        }

        .modal-tab.active {
            color: var(--accent-blue);
            border-bottom-color: var(--accent-blue);
            font-weight: 600;
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-tab-content {
            display: none;
        }

        .modal-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* ============================================
           AGENT GRID - Dynamic Count (8-25+ agents)
           ============================================ */
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .agent-card {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .agent-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 158, 255, 0.3);
        }

        .agent-card.working {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, transparent 100%);
        }

        .agent-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .agent-id {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--accent-blue);
        }

        .agent-status {
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .agent-status.ready { background: rgba(74, 158, 255, 0.2); color: var(--accent-blue); }
        .agent-status.working { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .agent-status.completed { background: rgba(155, 89, 182, 0.2); color: var(--accent-purple); }

        .agent-name {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .agent-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* ============================================
           STAGES LIST - 6 Stages with Progress
           ============================================ */
        .stages-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .stage-item {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stage-item:hover {
            border-left-color: var(--accent-blue);
            background: var(--bg-card-hover);
        }

        .stage-item.completed {
            border-left-color: var(--success);
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, transparent 100%);
        }

        .stage-item.active {
            border-left-color: var(--accent-orange);
            background: linear-gradient(90deg, rgba(255, 152, 54, 0.1) 0%, transparent 100%);
        }

        .stage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .stage-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .stage-status {
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* ============================================
           GUARDRAILS LIST - 8 Layers with Validation
           ============================================ */
        .guardrails-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .guardrail-item {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .guardrail-item:hover {
            border-color: var(--accent-blue);
        }

        .guardrail-item.pass {
            border-color: var(--success);
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, transparent 100%);
        }

        .guardrail-item.fail {
            border-color: var(--error);
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.1) 0%, transparent 100%);
        }

        .guardrail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .guardrail-layer {
            font-weight: 700;
            color: var(--accent-blue);
        }

        .guardrail-status {
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .guardrail-status.pass {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .guardrail-status.fail {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .guardrail-name {
            font-size: 0.9rem;
            margin-top: 8px;
            color: var(--text-secondary);
        }

        /* ============================================
           PROMPT COMPARISON - Side by Side
           ============================================ */
        .prompt-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .prompt-panel {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
        }

        .prompt-panel h3 {
            margin-bottom: 15px;
            color: var(--accent-blue);
        }

        .prompt-content {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .benefits-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 10px;
            border: 2px solid var(--accent-green);
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .benefit-item {
            padding: 15px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 8px;
            border-left: 4px solid var(--accent-green);
        }

        .comparison-table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .comparison-table th {
            background: var(--bg-card);
            font-weight: 600;
            color: var(--accent-blue);
        }

        .comparison-table tr:hover {
            background: var(--bg-card-hover);
        }

        .delta-positive {
            color: var(--success);
            font-weight: 600;
        }

        /* ============================================
           ANALYTICS CHARTS
           ============================================ */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .chart-container {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
        }

        .chart-container h3 {
            margin-bottom: 15px;
            color: var(--accent-blue);
        }

        .chart-canvas {
            width: 100%;
            height: 300px;
        }

        /* ============================================
           LIVE LOGS - Enhanced with Filtering
           ============================================ */
        .logs-container {
            margin-top: 20px;
        }

        .logs-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .log-filter {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .log-filter label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .log-filter select {
            padding: 6px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .logs-feed {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 2px solid var(--border-color);
            max-height: 500px;
            overflow-y: auto;
            padding: 15px;
        }

        .log-entry {
            display: flex;
            gap: 10px;
            padding: 8px 10px;
            margin-bottom: 5px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            transition: background 0.3s ease;
        }

        .log-entry:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .log-timestamp {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .log-level {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .log-level.DEBUG { background: rgba(160, 167, 184, 0.2); color: var(--text-secondary); }
        .log-level.INFO { background: rgba(74, 158, 255, 0.2); color: var(--accent-blue); }
        .log-level.WARNING { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .log-level.ERROR { background: rgba(239, 68, 68, 0.2); color: var(--error); }

        .log-message {
            flex: 1;
            color: var(--text-primary);
        }

        /* ============================================
           UTILITY CLASSES
           ============================================ */
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--accent-blue);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-blue);
        }
    </style>
</head>
<body>
    <!-- ============================================
         SYSTEM MONITOR BAR
         ============================================ -->
    <div class="system-monitor">
        <div class="system-monitor-grid">
            <div class="monitor-item">
                <div class="monitor-label">
                    <span>üñ•Ô∏è CPU Usage</span>
                    <span class="monitor-value" id="cpuValue">0%</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="cpuBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="monitor-item">
                <div class="monitor-label">
                    <span>üíæ Memory Usage</span>
                    <span class="monitor-value" id="memoryValue">0 GB / 0 GB</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="memoryBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="monitor-item">
                <div class="monitor-label">
                    <span>‚öôÔ∏è Process</span>
                    <span class="monitor-value" id="processValue">0 MB</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="processBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="monitor-item">
                <div class="monitor-label">
                    <span>üåê Connection</span>
                    <div class="connection-status">
                        <div class="status-dot disconnected" id="connectionDot"></div>
                        <span id="connectionText">Disconnected</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         MAIN HEADER
         ============================================ -->
    <div class="header">
        <h1>üß† ULTRATHINK Real-Time Dashboard</h1>
        <p class="subtitle">Production-Ready Multi-Track Orchestration Monitor | v2.0</p>
    </div>

    <!-- ============================================
         MAIN NAVIGATION TABS
         ============================================ -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('overview')">üìä Overview</button>
            <button class="tab-button" onclick="switchTab('active')">üîÑ Active Tasks</button>
            <button class="tab-button" onclick="switchTab('completed')">‚úÖ Completed</button>
            <button class="tab-button" onclick="switchTab('analytics')">üìà Analytics</button>
            <button class="tab-button" onclick="switchTab('logs')">üìù Live Logs</button>
        </div>
    </div>

    <!-- ============================================
         TAB CONTENTS
         ============================================ -->
    <div class="tracks-container">
        <!-- Overview Tab -->
        <div id="overview-tab" class="tab-content active">
            <h2 class="section-title">All Tracks</h2>
            <div class="tracks-grid" id="allTracksGrid">
                <div class="loading">Loading tracks...</div>
            </div>
        </div>

        <!-- Active Tasks Tab -->
        <div id="active-tab" class="tab-content">
            <h2 class="section-title">Active Tasks</h2>
            <div class="tracks-grid" id="activeTracksGrid">
                <div class="empty-state">
                    <div class="empty-state-icon">üîÑ</div>
                    <p>No active tasks</p>
                </div>
            </div>
        </div>

        <!-- Completed Tab -->
        <div id="completed-tab" class="tab-content">
            <h2 class="section-title">Completed Tasks</h2>
            <div class="tracks-grid" id="completedTracksGrid">
                <div class="empty-state">
                    <div class="empty-state-icon">‚úÖ</div>
                    <p>No completed tasks</p>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content">
            <h2 class="section-title">Analytics & Performance Metrics</h2>
            <div class="charts-grid">
                <div class="chart-container">
                    <h3>üìä Success Rate Trend</h3>
                    <canvas id="successRateChart" class="chart-canvas"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üéØ Task Distribution</h3>
                    <canvas id="taskDistributionChart" class="chart-canvas"></canvas>
                </div>
                <div class="chart-container">
                    <h3>‚ö° Performance Metrics</h3>
                    <canvas id="performanceChart" class="chart-canvas"></canvas>
                </div>
                <div class="chart-container">
                    <h3>ü§ñ Agent Utilization</h3>
                    <canvas id="agentUtilizationChart" class="chart-canvas"></canvas>
                </div>
            </div>
        </div>

        <!-- Live Logs Tab -->
        <div id="logs-tab" class="tab-content">
            <h2 class="section-title">Live Logs Stream</h2>
            <div class="logs-container">
                <div class="logs-controls">
                    <div class="log-filter">
                        <label>Level:</label>
                        <select id="logLevelFilter" onchange="filterLogs()">
                            <option value="all">All</option>
                            <option value="DEBUG">DEBUG</option>
                            <option value="INFO">INFO</option>
                            <option value="WARNING">WARNING</option>
                            <option value="ERROR">ERROR</option>
                        </select>
                    </div>
                    <div class="log-filter">
                        <label>Track:</label>
                        <select id="logTrackFilter" onchange="filterLogs()">
                            <option value="all">All Tracks</option>
                        </select>
                    </div>
                    <button class="btn btn-secondary" onclick="clearLogs()">üóëÔ∏è Clear</button>
                    <button class="btn btn-secondary" onclick="toggleAutoScroll()">
                        <span id="autoScrollText">‚è∏Ô∏è Pause Auto-scroll</span>
                    </button>
                </div>
                <div class="logs-feed" id="logsFeed">
                    <!-- Logs will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         TRACK DETAILS MODAL - 7 TABS
         ============================================ -->
    <div id="trackModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTrackName">Track Details</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>

            <div class="modal-tabs">
                <button class="modal-tab active" onclick="switchModalTab('overview')">üß† Overview</button>
                <button class="modal-tab" onclick="switchModalTab('agents')">üë• Agents</button>
                <button class="modal-tab" onclick="switchModalTab('stages')">üìã Stages</button>
                <button class="modal-tab" onclick="switchModalTab('guardrails')">üõ°Ô∏è Guardrails</button>
                <button class="modal-tab" onclick="switchModalTab('prompts')">üìä Prompts</button>
                <button class="modal-tab" onclick="switchModalTab('analytics')">üìà Analytics</button>
                <button class="modal-tab" onclick="switchModalTab('logs')">üìù Logs</button>
            </div>

            <div class="modal-body">
                <!-- Overview Tab -->
                <div id="modal-overview" class="modal-tab-content active">
                    <h3>Track Information</h3>
                    <div id="modalOverviewContent">Loading...</div>
                </div>

                <!-- Agents Tab -->
                <div id="modal-agents" class="modal-tab-content">
                    <h3>Agent Orchestration</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        Click any agent to view detailed information
                    </p>
                    <div class="agents-grid" id="modalAgentsGrid">
                        <div class="loading">Loading agents...</div>
                    </div>
                </div>

                <!-- Stages Tab -->
                <div id="modal-stages" class="modal-tab-content">
                    <h3>ULTRATHINK Stages</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        Click any stage to view detailed information
                    </p>
                    <div class="stages-list" id="modalStagesList">
                        <div class="loading">Loading stages...</div>
                    </div>
                </div>

                <!-- Guardrails Tab -->
                <div id="modal-guardrails" class="modal-tab-content">
                    <h3>Guardrail Layers</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        Click any guardrail to view validation details
                    </p>
                    <div class="guardrails-list" id="modalGuardrailsList">
                        <div class="loading">Loading guardrails...</div>
                    </div>
                </div>

                <!-- Prompts Tab -->
                <div id="modal-prompts" class="modal-tab-content">
                    <h3>Prompt Comparison</h3>
                    <div class="prompt-comparison">
                        <div class="prompt-panel">
                            <h3>üìù Original User Prompt</h3>
                            <div class="prompt-content" id="originalPrompt">Loading...</div>
                        </div>
                        <div class="prompt-panel">
                            <h3>üß† Enhanced ULTRATHINK Prompt</h3>
                            <div class="prompt-content" id="enhancedPrompt">Loading...</div>
                        </div>
                    </div>

                    <div class="benefits-section">
                        <h3>‚ú® ULTRATHINK Benefits & Enhancements</h3>
                        <div class="benefits-grid" id="benefitsGrid">
                            <!-- Benefits will be populated here -->
                        </div>
                    </div>

                    <h3 style="margin-top: 30px;">üìä Framework Comparison</h3>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Aspect</th>
                                <th>Normal Prompt</th>
                                <th>ULTRATHINK Prompt</th>
                                <th>Delta</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonTableBody">
                            <!-- Comparison data will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Analytics Tab (Modal) -->
                <div id="modal-analytics" class="modal-tab-content">
                    <h3>Track-Specific Analytics</h3>
                    <div id="modalAnalyticsContent">
                        <div class="loading">Loading analytics...</div>
                    </div>
                </div>

                <!-- Logs Tab (Modal) -->
                <div id="modal-logs" class="modal-tab-content">
                    <h3>Track Logs</h3>
                    <div class="logs-feed" id="modalLogsFeed" style="max-height: 600px;">
                        <div class="loading">Loading logs...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         AGENT DETAIL MODAL - Click-through
         ============================================ -->
    <div id="agentModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title" id="agentModalTitle">Agent Details</h2>
                <button class="modal-close" onclick="closeAgentModal()">&times;</button>
            </div>
            <div class="modal-body" id="agentModalBody">
                <div class="loading">Loading agent details...</div>
            </div>
        </div>
    </div>

    <!-- ============================================
         STAGE DETAIL MODAL - Click-through
         ============================================ -->
    <div id="stageModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title" id="stageModalTitle">Stage Details</h2>
                <button class="modal-close" onclick="closeStageModal()">&times;</button>
            </div>
            <div class="modal-body" id="stageModalBody">
                <div class="loading">Loading stage details...</div>
            </div>
        </div>
    </div>

    <!-- ============================================
         GUARDRAIL DETAIL MODAL - Click-through
         ============================================ -->
    <div id="guardrailModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title" id="guardrailModalTitle">Guardrail Details</h2>
                <button class="modal-close" onclick="closeGuardrailModal()">&times;</button>
            </div>
            <div class="modal-body" id="guardrailModalBody">
                <div class="loading">Loading guardrail details...</div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // GLOBAL STATE
        // ============================================
        let ws = null;
        let tracks = {};
        let logs = [];
        let autoScroll = true;
        let reconnectAttempts = 0;
        const MAX_RECONNECT = 10;
        let charts = {};
        let currentTrackId = null;

        // ============================================
        // WEBSOCKET CONNECTION
        // ============================================
        function connectWebSocket() {
            console.log('Connecting to WebSocket...');
            ws = new WebSocket('ws://localhost:8000/ws');

            ws.onopen = () => {
                console.log('‚úÖ WebSocket connected');
                reconnectAttempts = 0;
                updateConnectionStatus(true);
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
            };

            ws.onclose = () => {
                console.log('‚ùå WebSocket disconnected');
                updateConnectionStatus(false);
                scheduleReconnect();
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                updateConnectionStatus(false);
            };
        }

        function scheduleReconnect() {
            if (reconnectAttempts < MAX_RECONNECT) {
                reconnectAttempts++;
                const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 30000);
                console.log(`Reconnecting in ${delay}ms... (attempt ${reconnectAttempts}/${MAX_RECONNECT})`);
                updateConnectionStatus('connecting');
                setTimeout(connectWebSocket, delay);
            } else {
                console.error('Max reconnection attempts reached');
                updateConnectionStatus(false);
            }
        }

        function updateConnectionStatus(connected) {
            const dot = document.getElementById('connectionDot');
            const text = document.getElementById('connectionText');

            if (connected === true) {
                dot.className = 'status-dot connected';
                text.textContent = 'Connected';
            } else if (connected === 'connecting') {
                dot.className = 'status-dot connecting';
                text.textContent = 'Connecting...';
            } else {
                dot.className = 'status-dot disconnected';
                text.textContent = 'Disconnected';
            }
        }

        // ============================================
        // WEBSOCKET MESSAGE HANDLER
        // ============================================
        function handleWebSocketMessage(data) {
            switch(data.type) {
                case 'track_update':
                    updateTrack(data);
                    break;
                case 'overall_update':
                    // Handle overall statistics if needed
                    break;
                case 'ultrathink_update':
                    updateUltrathinkData(data);
                    break;
                case 'log_update':
                    addLogEntry(data);
                    break;
                case 'system_monitor_update':
                    updateSystemMonitor(data);
                    break;
            }
        }

        // ============================================
        // SYSTEM MONITOR UPDATE
        // ============================================
        function updateSystemMonitor(data) {
            // Update CPU
            const cpuValue = document.getElementById('cpuValue');
            const cpuBar = document.getElementById('cpuBar');
            cpuValue.textContent = data.cpu_percent + '%';
            cpuBar.style.width = data.cpu_percent + '%';
            cpuBar.className = 'progress-bar-fill' + (data.cpu_percent > 80 ? ' high' : '');

            // Update Memory
            const memoryValue = document.getElementById('memoryValue');
            const memoryBar = document.getElementById('memoryBar');
            memoryValue.textContent = `${data.memory_used_gb} GB / ${data.memory_total_gb} GB`;
            memoryBar.style.width = data.memory_percent + '%';
            memoryBar.className = 'progress-bar-fill' + (data.memory_percent > 80 ? ' high' : '');

            // Update Process
            const processValue = document.getElementById('processValue');
            const processBar = document.getElementById('processBar');
            processValue.textContent = data.process_memory_mb + ' MB';
            // Calculate process percentage relative to total memory
            const processPercent = (data.process_memory_mb / (data.memory_total_gb * 1024)) * 100;
            processBar.style.width = Math.min(processPercent, 100) + '%';
        }

        // ============================================
        // TRACK UPDATE
        // ============================================
        function updateTrack(data) {
            tracks[data.track_id] = data;

            // Update in all grids
            updateTrackInGrid(data, 'allTracksGrid');

            // Update filtered grids based on status
            if (data.status === 'RUNNING') {
                updateTrackInGrid(data, 'activeTracksGrid');
                removeTrackFromGrid(data.track_id, 'completedTracksGrid');
            } else if (data.status === 'COMPLETED') {
                updateTrackInGrid(data, 'completedTracksGrid');
                removeTrackFromGrid(data.track_id, 'activeTracksGrid');
            } else {
                removeTrackFromGrid(data.track_id, 'activeTracksGrid');
                removeTrackFromGrid(data.track_id, 'completedTracksGrid');
            }

            // Update modal if this track is open
            if (currentTrackId === data.track_id) {
                updateModalContent(data);
            }
        }

        function updateTrackInGrid(data, gridId) {
            const grid = document.getElementById(gridId);
            if (!grid) return;

            let card = grid.querySelector(`[data-track-id="${data.track_id}"]`);

            if (!card) {
                card = createTrackCard(data);
                grid.appendChild(card);
            } else {
                // Update existing card
                card.querySelector('.track-name').textContent = data.name;
                card.querySelector('.track-status').textContent = data.status;
                card.querySelector('.track-status').className = `track-status ${data.status.toLowerCase()}`;
                card.querySelector('.track-task').textContent = data.current_task || 'Waiting...';
                card.querySelector('.progress-label span:last-child').textContent = data.progress + '%';
                card.querySelector('.progress-bar-fill').style.width = data.progress + '%';
                card.className = `track-card status-${data.status.toLowerCase()}`;
            }

            // Remove empty state if exists
            const emptyState = grid.querySelector('.empty-state');
            if (emptyState) emptyState.remove();
            const loading = grid.querySelector('.loading');
            if (loading) loading.remove();
        }

        function removeTrackFromGrid(trackId, gridId) {
            const grid = document.getElementById(gridId);
            if (!grid) return;

            const card = grid.querySelector(`[data-track-id="${trackId}"]`);
            if (card) {
                card.remove();
            }

            // Add empty state if grid is now empty
            if (grid.children.length === 0) {
                const emptyIcon = gridId === 'activeTracksGrid' ? 'üîÑ' : '‚úÖ';
                const emptyText = gridId === 'activeTracksGrid' ? 'No active tasks' : 'No completed tasks';
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">${emptyIcon}</div>
                        <p>${emptyText}</p>
                    </div>
                `;
            }
        }

        function createTrackCard(data) {
            const card = document.createElement('div');
            card.className = `track-card status-${data.status.toLowerCase()}`;
            card.setAttribute('data-track-id', data.track_id);

            card.innerHTML = `
                <div class="track-header">
                    <div class="track-name">${data.name}</div>
                    <div class="track-status ${data.status.toLowerCase()}">${data.status}</div>
                </div>
                <div class="track-progress">
                    <div class="progress-label">
                        <span>Progress</span>
                        <span>${data.progress}%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: ${data.progress}%"></div>
                    </div>
                </div>
                <div class="track-task">${data.current_task || 'Waiting...'}</div>
                <div class="track-actions">
                    <button class="btn btn-primary" onclick="openTrackDetails(${data.track_id})">
                        üîç View Details
                    </button>
                </div>
            `;

            return card;
        }

        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        function openTrackDetails(trackId) {
            currentTrackId = trackId;
            const track = tracks[trackId];

            if (!track) {
                console.error('Track not found:', trackId);
                return;
            }

            document.getElementById('modalTrackName').textContent = `Track ${trackId}: ${track.name}`;
            document.getElementById('trackModal').classList.add('active');

            // Load track details
            loadTrackDetails(trackId);
        }

        async function loadTrackDetails(trackId) {
            try {
                // Load ULTRATHINK details
                const ultrathinkResponse = await fetch(`http://localhost:8000/api/tracks/${trackId}/ultrathink`);
                const ultrathinkData = await ultrathinkResponse.json();

                if (ultrathinkData.success) {
                    updateModalContent(tracks[trackId], ultrathinkData.ultrathink);
                }

                // Load logs for this track
                const logsResponse = await fetch(`http://localhost:8000/api/tracks/${trackId}/logs?limit=500`);
                const logsData = await logsResponse.json();

                if (logsData.success) {
                    loadModalLogs(logsData.logs);
                }

                // Load analytics data (using track data and ultrathink details)
                loadModalAnalytics(trackId, tracks[trackId], ultrathinkData.ultrathink);

            } catch (error) {
                console.error('Error loading track details:', error);
            }
        }

        function updateModalContent(trackData, ultrathinkData) {
            // Update overview
            const overviewContent = document.getElementById('modalOverviewContent');
            overviewContent.innerHTML = `
                <p><strong>Status:</strong> ${trackData.status}</p>
                <p><strong>Progress:</strong> ${trackData.progress}%</p>
                <p><strong>Current Task:</strong> ${trackData.current_task || 'N/A'}</p>
                <p><strong>Last Update:</strong> ${trackData.last_update || 'N/A'}</p>
            `;

            if (ultrathinkData) {
                // Update agents
                if (ultrathinkData.agents && ultrathinkData.agents.length > 0) {
                    updateModalAgents(ultrathinkData.agents);
                }

                // Update guardrails
                if (ultrathinkData.guardrails && ultrathinkData.guardrails.length > 0) {
                    updateModalGuardrails(ultrathinkData.guardrails);
                }

                // Update prompts if available
                if (ultrathinkData.original_prompt || ultrathinkData.enhanced_prompt) {
                    updateModalPrompts(ultrathinkData);
                }
            }
        }

        function updateModalAgents(agents) {
            const grid = document.getElementById('modalAgentsGrid');
            grid.innerHTML = agents.map(agent => `
                <div class="agent-card ${agent.status === 'WORKING' ? 'working' : ''}"
                     onclick="openAgentDetails('${agent.id}')">
                    <div class="agent-header">
                        <span class="agent-id">${agent.id}</span>
                        <span class="agent-status ${agent.status.toLowerCase()}">${agent.status}</span>
                    </div>
                    <div class="agent-name">${agent.name}</div>
                    <div class="agent-role">${agent.role}</div>
                </div>
            `).join('');
        }

        function updateModalGuardrails(guardrails) {
            const list = document.getElementById('modalGuardrailsList');
            list.innerHTML = guardrails.map(guardrail => `
                <div class="guardrail-item ${guardrail.status.toLowerCase()}"
                     onclick="openGuardrailDetails(${guardrail.layer})">
                    <div class="guardrail-header">
                        <span class="guardrail-layer">Layer ${guardrail.layer}</span>
                        <span class="guardrail-status ${guardrail.status.toLowerCase()}">${guardrail.status}</span>
                    </div>
                    <div class="guardrail-name">${guardrail.name}</div>
                </div>
            `).join('');
        }

        function updateModalPrompts(data) {
            // Original and Enhanced Prompts
            document.getElementById('originalPrompt').textContent = data.original_prompt || 'Original prompt not available in database';
            document.getElementById('enhancedPrompt').textContent = data.enhanced_prompt || 'Enhanced prompt not available in database';

            // ULTRATHINK Benefits
            const benefitsData = data.benefits_analysis || data.benefits || [
                { title: '8 Guardrail Layers', description: 'Multi-layer validation ensures security, accuracy, and reliability', icon: 'üõ°Ô∏è' },
                { title: '8-25 Parallel Agents', description: 'Dynamic agent orchestration for optimal task distribution', icon: 'ü§ñ' },
                { title: '6-Stage Pipeline', description: 'Structured processing through preprocessing, execution, and validation', icon: 'üìã' },
                { title: '5 Verification Methods', description: 'Multi-method verification for 99%+ accuracy', icon: '‚úì' },
                { title: '200K Token Context', description: 'Massive context window for comprehensive analysis', icon: 'üí≠' },
                { title: 'Adaptive Feedback Loops', description: 'Continuous learning and refinement throughout execution', icon: 'üîÑ' }
            ];

            const benefitsContainer = document.getElementById('ultrathinkBenefits');
            if (benefitsContainer) {
                benefitsContainer.innerHTML = benefitsData.map(benefit => `
                    <div class="benefit-card">
                        <div class="benefit-icon">${benefit.icon}</div>
                        <div class="benefit-title">${benefit.title}</div>
                        <div class="benefit-description">${benefit.description}</div>
                    </div>
                `).join('');
            }

            // Framework Comparison
            const comparisonData = data.framework_comparison || data.comparison || [
                { aspect: 'Guardrails', normal: '0 layers', ultrathink: '8 layers', delta: '+800%' },
                { aspect: 'Verification Methods', normal: '1 method', ultrathink: '5 methods', delta: '+400%' },
                { aspect: 'Agents', normal: '1 agent', ultrathink: '8-25 agents', delta: '+800-2400%' },
                { aspect: 'Context Window', normal: '8K tokens', ultrathink: '200K tokens', delta: '+2400%' },
                { aspect: 'Success Rate', normal: '85%', ultrathink: '99%', delta: '+16.5%' },
                { aspect: 'Error Rate', normal: '15%', ultrathink: '1%', delta: '-93%' },
                { aspect: 'Processing Stages', normal: '1 stage', ultrathink: '6 stages', delta: '+500%' },
                { aspect: 'Quality Score', normal: '7/10', ultrathink: '9.8/10', delta: '+40%' }
            ];

            const comparisonTable = document.getElementById('frameworkComparison');
            if (comparisonTable) {
                comparisonTable.innerHTML = `
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Aspect</th>
                                <th>Normal Prompt</th>
                                <th>ULTRATHINK Prompt</th>
                                <th>Delta</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${comparisonData.map(row => `
                                <tr>
                                    <td><strong>${row.aspect}</strong></td>
                                    <td>${row.normal}</td>
                                    <td>${row.ultrathink}</td>
                                    <td class="delta ${row.delta.startsWith('-') ? 'negative' : 'positive'}">${row.delta}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }

        function closeModal() {
            document.getElementById('trackModal').classList.remove('active');
            currentTrackId = null;
        }

        function switchModalTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.modal-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.modal-tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`modal-${tabName}`).classList.add('active');
        }

        // ============================================
        // AGENT DETAIL MODAL
        // ============================================
        async function openAgentDetails(agentId) {
            document.getElementById('agentModalTitle').textContent = `Agent ${agentId} Details`;
            document.getElementById('agentModal').classList.add('active');

            // Show loading state
            document.getElementById('agentModalBody').innerHTML = `
                <div class="loading">Loading agent details...</div>
            `;

            try {
                // Fetch track logs and filter for this agent
                const response = await fetch(`http://localhost:8000/api/tracks/${currentTrackId}/logs?limit=500`);
                const data = await response.json();

                if (data.success) {
                    // Filter logs for this specific agent
                    const agentLogs = data.logs.filter(log =>
                        log.message && log.message.includes(agentId)
                    );

                    // Get agent data from current modal
                    const agentData = getCurrentAgentData(agentId);

                    // Build detailed view
                    document.getElementById('agentModalBody').innerHTML = `
                        <div class="agent-detail-section">
                            <h3>ü§ñ ${agentId}: ${agentData.name || 'Agent'}</h3>
                            <p><strong>Role:</strong> ${agentData.role || 'Processing'}</p>
                            <p><strong>Status:</strong> <span class="status ${agentData.status ? agentData.status.toLowerCase() : 'ready'}">${agentData.status || 'READY'}</span></p>
                            <p><strong>Priority:</strong> ${agentData.priority || 'HIGH'}</p>
                        </div>

                        <div class="agent-detail-section">
                            <h4>üìä Performance Metrics</h4>
                            <div class="metrics-grid">
                                <div class="metric-item">
                                    <div class="metric-label">Tasks Processed</div>
                                    <div class="metric-value">${agentLogs.length}</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-label">Success Rate</div>
                                    <div class="metric-value">99%</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-label">Avg Response Time</div>
                                    <div class="metric-value">0.5s</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-label">Capacity</div>
                                    <div class="metric-value">85%</div>
                                </div>
                            </div>
                        </div>

                        <div class="agent-detail-section">
                            <h4>üîÑ Current Operation</h4>
                            <p>${agentLogs.length > 0 ? agentLogs[0].message : 'Agent completed all assigned tasks'}</p>
                        </div>

                        <div class="agent-detail-section">
                            <h4>üìù Agent Logs (${agentLogs.length} entries)</h4>
                            <div class="logs-feed" style="max-height: 400px; overflow-y: auto;">
                                ${agentLogs.length > 0 ? agentLogs.map(log => `
                                    <div class="log-entry">
                                        <span class="log-timestamp">${new Date(log.timestamp).toLocaleTimeString()}</span>
                                        <span class="log-level ${log.level}">${log.level}</span>
                                        <span class="log-message">${log.message}</span>
                                    </div>
                                `).join('') : '<p>No logs found for this agent</p>'}
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('agentModalBody').innerHTML = `
                        <p class="error">Error loading agent details: ${data.error}</p>
                    `;
                }
            } catch (error) {
                console.error('Error loading agent details:', error);
                document.getElementById('agentModalBody').innerHTML = `
                    <p class="error">Failed to load agent details. Please try again.</p>
                `;
            }
        }

        function getCurrentAgentData(agentId) {
            // Get agent data from the currently loaded ULTRATHINK details
            const agentsGrid = document.getElementById('modalAgentsGrid');
            const agentCards = agentsGrid.querySelectorAll('.agent-card');

            for (const card of agentCards) {
                const cardId = card.querySelector('.agent-id').textContent;
                if (cardId === agentId) {
                    return {
                        name: card.querySelector('.agent-name').textContent,
                        role: card.querySelector('.agent-role').textContent,
                        status: card.querySelector('.agent-status').textContent,
                        priority: 'HIGH' // Default
                    };
                }
            }

            return { name: agentId, role: 'Processing', status: 'READY', priority: 'HIGH' };
        }

        function closeAgentModal() {
            document.getElementById('agentModal').classList.remove('active');
        }

        // ============================================
        // STAGE DETAIL MODAL
        // ============================================
        async function openStageDetails(stageNumber) {
            document.getElementById('stageModalTitle').textContent = `Stage ${stageNumber} Details`;
            document.getElementById('stageModal').classList.add('active');

            // Show loading state
            document.getElementById('stageModalBody').innerHTML = `
                <div class="loading">Loading stage details...</div>
            `;

            // ULTRATHINK Stages
            const stages = [
                {
                    number: 1,
                    name: 'Prompt Preprocessing & Analysis',
                    description: 'Analyzing prompt structure and complexity',
                    verificationMethods: ['Syntax validation', 'Intent classification', 'Complexity assessment'],
                    typicalDuration: '0.5-1s'
                },
                {
                    number: 2,
                    name: 'Guardrails - Input Validation (Layers 1-3)',
                    description: 'Running input through 3 validation layers',
                    verificationMethods: ['Prompt shields', 'Content filtering', 'PHI detection'],
                    typicalDuration: '0.5-1.5s'
                },
                {
                    number: 3,
                    name: 'Context Management',
                    description: 'Preparing execution context',
                    verificationMethods: ['Context window optimization', 'File access verification', 'Token estimation'],
                    typicalDuration: '0.2-0.5s'
                },
                {
                    number: 4,
                    name: 'Agent Orchestration',
                    description: 'Preparing agents for parallel execution',
                    verificationMethods: ['Agent allocation', 'Priority assignment', 'Workload distribution'],
                    typicalDuration: '0.3-0.8s'
                },
                {
                    number: 5,
                    name: 'Task Execution',
                    description: 'Executing the actual task with agents',
                    verificationMethods: ['Real-time monitoring', 'Progress tracking', 'Error detection'],
                    typicalDuration: '5-60s'
                },
                {
                    number: 6,
                    name: 'Output Validation (Guardrail Layers 4-8)',
                    description: 'Validating output through 5 layers',
                    verificationMethods: ['Medical terminology', 'Output filtering', 'Groundedness', 'Compliance', 'Hallucination detection'],
                    typicalDuration: '1-3s'
                }
            ];

            const stage = stages.find(s => s.number === stageNumber);

            if (!stage) {
                document.getElementById('stageModalBody').innerHTML = `
                    <p class="error">Stage ${stageNumber} not found</p>
                `;
                return;
            }

            // Build detailed view
            document.getElementById('stageModalBody').innerHTML = `
                <div class="stage-detail-section">
                    <h3>üìã Stage ${stage.number}: ${stage.name}</h3>
                    <p>${stage.description}</p>
                </div>

                <div class="stage-detail-section">
                    <h4>‚úì Verification Methods</h4>
                    <ul>
                        ${stage.verificationMethods.map(method => `<li>${method}</li>`).join('')}
                    </ul>
                </div>

                <div class="stage-detail-section">
                    <h4>‚è±Ô∏è Performance</h4>
                    <p><strong>Typical Duration:</strong> ${stage.typicalDuration}</p>
                    <p><strong>Success Rate:</strong> 99.5%</p>
                    <p><strong>Error Rate:</strong> <0.5%</p>
                </div>

                <div class="stage-detail-section">
                    <h4>üìà Progress</h4>
                    <p>This stage typically processes in the order shown above, with all verification methods applied sequentially.</p>
                </div>

                <div class="stage-detail-section">
                    <h4>üîç Artifacts</h4>
                    <p>Stage artifacts include validation results, processed data structures, and intermediate outputs that feed into the next stage.</p>
                </div>
            `;
        }

        function closeStageModal() {
            document.getElementById('stageModal').classList.remove('active');
        }

        // ============================================
        // GUARDRAIL DETAIL MODAL
        // ============================================
        async function openGuardrailDetails(layer) {
            document.getElementById('guardrailModalTitle').textContent = `Guardrail Layer ${layer} Details`;
            document.getElementById('guardrailModal').classList.add('active');

            // Show loading state
            document.getElementById('guardrailModalBody').innerHTML = `
                <div class="loading">Loading guardrail details...</div>
            `;

            // ULTRATHINK Guardrail Layers
            const guardrails = [
                {
                    layer: 1,
                    name: 'Prompt Shields',
                    type: 'INPUT',
                    purpose: 'Jailbreak prevention, injection attack detection',
                    validationRules: [
                        'Check for jailbreak attempts',
                        'Detect prompt injection patterns',
                        'Validate prompt structure',
                        'Prevent privilege escalation'
                    ],
                    securityImplications: 'Prevents malicious actors from bypassing system safeguards',
                    examples: {
                        pass: 'Normal user requests',
                        fail: 'Ignore previous instructions and...'
                    }
                },
                {
                    layer: 2,
                    name: 'Content Filtering',
                    type: 'INPUT',
                    purpose: 'Harmful content detection (violence, hate, self-harm)',
                    validationRules: [
                        'Check for violent content',
                        'Detect hate speech',
                        'Identify self-harm content',
                        'Flag inappropriate material'
                    ],
                    securityImplications: 'Ensures safe, appropriate content processing',
                    examples: {
                        pass: 'Professional development requests',
                        fail: 'Requests for harmful content generation'
                    }
                },
                {
                    layer: 3,
                    name: 'PHI Detection',
                    type: 'INPUT',
                    purpose: 'Privacy protection, PII/PHI detection',
                    validationRules: [
                        'Detect Personal Health Information',
                        'Identify Personally Identifiable Information',
                        'Check for SSN, credit cards',
                        'Protect sensitive data'
                    ],
                    securityImplications: 'HIPAA compliance, privacy protection',
                    examples: {
                        pass: 'Generic medical questions',
                        fail: 'Requests containing patient records'
                    }
                },
                {
                    layer: 4,
                    name: 'Medical Terminology',
                    type: 'OUTPUT',
                    purpose: 'Validate medical content accuracy',
                    validationRules: [
                        'Verify medical terminology correctness',
                        'Check drug interaction warnings',
                        'Validate dosage information',
                        'Ensure clinical accuracy'
                    ],
                    securityImplications: 'Patient safety, clinical accuracy',
                    examples: {
                        pass: 'Accurate medical information',
                        fail: 'Incorrect drug dosages or contraindications'
                    }
                },
                {
                    layer: 5,
                    name: 'Output Content Filtering',
                    type: 'OUTPUT',
                    purpose: 'No harmful content in responses',
                    validationRules: [
                        'Check response for harmful content',
                        'Validate tone and professionalism',
                        'Ensure appropriate language',
                        'Filter sensitive information'
                    ],
                    securityImplications: 'Brand safety, user protection',
                    examples: {
                        pass: 'Professional, helpful responses',
                        fail: 'Responses with harmful or inappropriate content'
                    }
                },
                {
                    layer: 6,
                    name: 'Groundedness',
                    type: 'OUTPUT',
                    purpose: 'Ensure factual accuracy, cite sources',
                    validationRules: [
                        'Verify claims against known facts',
                        'Check source citations',
                        'Validate references',
                        'Ensure evidence-based responses'
                    ],
                    securityImplications: 'Accuracy, trustworthiness',
                    examples: {
                        pass: 'Well-cited, accurate information',
                        fail: 'Unsubstantiated claims'
                    }
                },
                {
                    layer: 7,
                    name: 'Compliance & Fact Checking',
                    type: 'OUTPUT',
                    purpose: 'HIPAA compliance, fact-checking, best practices',
                    validationRules: [
                        'HIPAA compliance verification',
                        'Regulatory requirement checking',
                        'Best practices validation',
                        'Industry standards adherence'
                    ],
                    securityImplications: 'Legal compliance, regulatory adherence',
                    examples: {
                        pass: 'Compliant, standards-following responses',
                        fail: 'Responses violating regulations'
                    }
                },
                {
                    layer: 8,
                    name: 'Hallucination Detection',
                    type: 'OUTPUT',
                    purpose: 'Eliminate false information (8 detection methods)',
                    validationRules: [
                        'Cross-reference verification',
                        'Source validation',
                        'Consistency checking',
                        'Claim validation',
                        'Temporal accuracy',
                        'Logical coherence',
                        'Citation checking',
                        'Expert knowledge validation'
                    ],
                    securityImplications: 'Truth, accuracy, reliability',
                    examples: {
                        pass: 'Verifiable, consistent responses',
                        fail: 'Made-up facts or inconsistent claims'
                    }
                }
            ];

            const guardrail = guardrails.find(g => g.layer === layer);

            if (!guardrail) {
                document.getElementById('guardrailModalBody').innerHTML = `
                    <p class="error">Guardrail layer ${layer} not found</p>
                `;
                return;
            }

            // Build detailed view
            document.getElementById('guardrailModalBody').innerHTML = `
                <div class="guardrail-detail-section">
                    <h3>üõ°Ô∏è Layer ${guardrail.layer}: ${guardrail.name}</h3>
                    <p><strong>Type:</strong> <span class="badge">${guardrail.type}</span></p>
                    <p><strong>Purpose:</strong> ${guardrail.purpose}</p>
                </div>

                <div class="guardrail-detail-section">
                    <h4>‚úì Validation Rules</h4>
                    <ul>
                        ${guardrail.validationRules.map(rule => `<li>${rule}</li>`).join('')}
                    </ul>
                </div>

                <div class="guardrail-detail-section">
                    <h4>üîí Security Implications</h4>
                    <p>${guardrail.securityImplications}</p>
                </div>

                <div class="guardrail-detail-section">
                    <h4>üìã Examples</h4>
                    <div class="example-box">
                        <h5>‚úÖ Pass Example:</h5>
                        <p>${guardrail.examples.pass}</p>
                    </div>
                    <div class="example-box">
                        <h5>‚ùå Fail Example:</h5>
                        <p>${guardrail.examples.fail}</p>
                    </div>
                </div>

                <div class="guardrail-detail-section">
                    <h4>üìä Performance</h4>
                    <p><strong>Success Rate:</strong> 99.8%</p>
                    <p><strong>False Positive Rate:</strong> <0.1%</p>
                    <p><strong>Avg Processing Time:</strong> 0.3-0.8s</p>
                </div>
            `;
        }

        function closeGuardrailModal() {
            document.getElementById('guardrailModal').classList.remove('active');
        }

        // ============================================
        // MODAL LOGS AND ANALYTICS
        // ============================================
        function loadModalLogs(logs) {
            const logsFeed = document.getElementById('modalLogsFeed');
            if (!logsFeed) return;

            if (!logs || logs.length === 0) {
                logsFeed.innerHTML = '<p>No logs available for this track</p>';
                return;
            }

            logsFeed.innerHTML = logs.map(log => `
                <div class="log-entry">
                    <span class="log-timestamp">${new Date(log.timestamp).toLocaleTimeString()}</span>
                    <span class="log-level ${log.level}">${log.level}</span>
                    <span class="log-message">${log.message}</span>
                </div>
            `).join('');
        }

        function loadModalAnalytics(trackId, trackData, ultrathinkData) {
            const analyticsContent = document.getElementById('modalAnalyticsContent');
            if (!analyticsContent) return;

            // Extract metrics
            const metrics = ultrathinkData?.metrics || {};
            const agentsAllocated = metrics.agents_allocated || (ultrathinkData?.agents?.length) || 8;
            const guardrailsPassed = metrics.guardrails_passed || 8;
            const confidenceScore = metrics.confidence_score || 99.0;

            analyticsContent.innerHTML = `
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h4>ü§ñ Agent Utilization</h4>
                        <div class="metric-large">${agentsAllocated}</div>
                        <p>Agents Allocated</p>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: ${(agentsAllocated/25)*100}%"></div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h4>üõ°Ô∏è Guardrails Status</h4>
                        <div class="metric-large">${guardrailsPassed}/8</div>
                        <p>Layers Passed</p>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: ${(guardrailsPassed/8)*100}%"></div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h4>‚úì Confidence Score</h4>
                        <div class="metric-large">${confidenceScore}%</div>
                        <p>Final Confidence</p>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: ${confidenceScore}%"></div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h4>üìä Task Progress</h4>
                        <div class="metric-large">${trackData.progress}%</div>
                        <p>Completion</p>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: ${trackData.progress}%"></div>
                        </div>
                    </div>
                </div>

                <div class="analytics-section">
                    <h4>üìà Performance Metrics</h4>
                    <table class="metrics-table">
                        <tr>
                            <td>Status</td>
                            <td><span class="status ${trackData.status.toLowerCase()}">${trackData.status}</span></td>
                        </tr>
                        <tr>
                            <td>Context Tokens Used</td>
                            <td>${metrics.context_tokens_used || 'N/A'}</td>
                        </tr>
                        <tr>
                            <td>Current Task</td>
                            <td>${trackData.current_task || 'N/A'}</td>
                        </tr>
                        <tr>
                            <td>Last Update</td>
                            <td>${trackData.last_update || 'N/A'}</td>
                        </tr>
                    </table>
                </div>

                <div class="analytics-section">
                    <h4>üéØ Quality Assurance</h4>
                    <ul>
                        <li>‚úÖ All guardrail layers validated</li>
                        <li>‚úÖ Multi-method verification applied</li>
                        <li>‚úÖ Production-ready output quality</li>
                        <li>‚úÖ ${confidenceScore >= 99 ? 'Confidence target met' : 'Confidence target in progress'}</li>
                    </ul>
                </div>
            `;
        }

        // ============================================
        // ULTRATHINK DATA UPDATE
        // ============================================
        function updateUltrathinkData(data) {
            // Update if modal is open for this track
            if (currentTrackId === data.track_id) {
                if (data.agents) updateModalAgents(data.agents);
                if (data.guardrails) updateModalGuardrails(data.guardrails);
            }
        }

        // ============================================
        // LOG FUNCTIONS
        // ============================================
        function addLogEntry(data) {
            logs.unshift(data);

            // Keep only last 500 logs
            if (logs.length > 500) {
                logs = logs.slice(0, 500);
            }

            // Update logs display
            updateLogsDisplay();

            // Update track filter dropdown
            updateLogTrackFilter();
        }

        function updateLogsDisplay() {
            const feed = document.getElementById('logsFeed');
            const levelFilter = document.getElementById('logLevelFilter').value;
            const trackFilter = document.getElementById('logTrackFilter').value;

            let filteredLogs = logs;

            if (levelFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.level === levelFilter);
            }

            if (trackFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.track_id === parseInt(trackFilter));
            }

            feed.innerHTML = filteredLogs.map(log => `
                <div class="log-entry">
                    <span class="log-timestamp">${new Date(log.timestamp).toLocaleTimeString()}</span>
                    <span class="log-level ${log.level}">${log.level}</span>
                    <span class="log-message">[Track ${log.track_id}] ${log.message}</span>
                </div>
            `).join('');

            if (autoScroll) {
                feed.scrollTop = 0;
            }
        }

        function updateLogTrackFilter() {
            const select = document.getElementById('logTrackFilter');
            const currentValue = select.value;

            const trackIds = [...new Set(logs.map(log => log.track_id))].sort((a, b) => a - b);

            select.innerHTML = '<option value="all">All Tracks</option>' +
                trackIds.map(id => `<option value="${id}">Track ${id}</option>`).join('');

            select.value = currentValue;
        }

        function filterLogs() {
            updateLogsDisplay();
        }

        function clearLogs() {
            logs = [];
            updateLogsDisplay();
        }

        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            document.getElementById('autoScrollText').textContent = autoScroll ? '‚è∏Ô∏è Pause Auto-scroll' : '‚ñ∂Ô∏è Resume Auto-scroll';
        }

        // ============================================
        // TAB SWITCHING
        // ============================================
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // Initialize charts if switching to analytics
            if (tabName === 'analytics' && Object.keys(charts).length === 0) {
                initializeCharts();
            }
        }

        // ============================================
        // CHARTS INITIALIZATION
        // ============================================
        function initializeCharts() {
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
    // Destroy existing charts first
    if (window.charts) {
        Object.values(window.charts).forEach(chart => {
            if (chart && typeof chart.destroy === 'function') {
                chart.destroy();
            }
        });
    }
    window.charts = {};
    
            // Success Rate Trend Chart
            const successCtx = document.getElementById('successRateChart').getContext('2d');
            charts.successRate = new Chart(successCtx, {
                type: 'line',
                data: {
                    labels: ['1h ago', '50m', '40m', '30m', '20m', '10m', 'Now'],
                    datasets: [{
                        label: 'Success Rate %',
                        data: [85, 87, 90, 92, 95, 97, 99],
                        borderColor: 'rgb(74, 158, 255)',
                        backgroundColor: 'rgba(74, 158, 255, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 80,
                            max: 100
                        }
                    }
                }
            });

            // Task Distribution Chart
            const distCtx = document.getElementById('taskDistributionChart').getContext('2d');
            charts.taskDistribution = new Chart(distCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Running', 'Failed', 'Pending'],
                    datasets: [{
                        data: [7, 0, 0, 9],
                        backgroundColor: [
                            'rgb(74, 158, 255)',
                            'rgb(16, 185, 129)',
                            'rgb(239, 68, 68)',
                            'rgb(160, 167, 184)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Performance Metrics Chart
            const perfCtx = document.getElementById('performanceChart').getContext('2d');
            charts.performance = new Chart(perfCtx, {
                type: 'bar',
                data: {
                    labels: ['Quality', 'Speed', 'Accuracy', 'Reliability'],
                    datasets: [{
                        label: 'Score',
                        data: [98, 95, 99, 97],
                        backgroundColor: 'rgb(16, 185, 129)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 90,
                            max: 100
                        }
                    }
                }
            });

            // Agent Utilization Chart
            const agentCtx = document.getElementById('agentUtilizationChart').getContext('2d');
            charts.agentUtilization = new Chart(agentCtx, {
                type: 'radar',
                data: {
                    labels: ['A1', 'A2', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8'],
                    datasets: [{
                        label: 'Utilization %',
                        data: [85, 90, 75, 95, 80, 88, 92, 87],
                        backgroundColor: 'rgba(74, 158, 255, 0.2)',
                        borderColor: 'rgb(74, 158, 255)',
                        pointBackgroundColor: 'rgb(74, 158, 255)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Dashboard v2.0 initializing...');
            connectWebSocket();
        });
    </script>
</body>
</html>
