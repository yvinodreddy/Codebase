@model RMMS.Models.RiceSales
@{
    ViewData["Title"] = "Invoice - Professional Template 1";
    Layout = null; // No layout for print
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Invoice</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

    <style>
        @@media print {
            .no-print { display: none !important; }
            body { margin: 0; }
            @@page { margin: 1cm; }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            background: #f5f5f5;
        }

        .invoice-container {
            max-width: 900px;
            margin: 20px auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .invoice-header {
            background: linear-gradient(135deg, #0090d2 0%, #006fa8 100%);
            color: white;
            padding: 40px;
        }

        .company-logo {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .invoice-title {
            font-size: 48px;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .invoice-details {
            padding: 40px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .detail-box {
            flex: 1;
        }

        .detail-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .invoice-table {
            margin: 30px 40px;
        }

        .invoice-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .invoice-table thead {
            background: #f8f9fa;
        }

        .invoice-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #dee2e6;
        }

        .invoice-table td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .invoice-table tbody tr:hover {
            background: #f8f9fa;
        }

        .text-right {
            text-align: right !important;
        }

        .invoice-summary {
            padding: 20px 40px 40px;
        }

        .summary-row {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }

        .summary-label {
            width: 200px;
            text-align: right;
            padding-right: 20px;
            font-weight: 500;
        }

        .summary-value {
            width: 150px;
            text-align: right;
            font-weight: 600;
        }

        .total-row {
            border-top: 2px solid #dee2e6;
            margin-top: 15px;
            padding-top: 15px;
        }

        .total-row .summary-label,
        .total-row .summary-value {
            font-size: 20px;
            color: #0090d2;
        }

        .invoice-footer {
            background: #f8f9fa;
            padding: 30px 40px;
            margin-top: 40px;
        }

        .footer-section {
            margin-bottom: 20px;
        }

        .footer-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #0090d2;
        }

        .print-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .badge-paid {
            position: absolute;
            top: 100px;
            right: 40px;
            background: #28a745;
            color: white;
            padding: 10px 30px;
            font-size: 24px;
            font-weight: 700;
            transform: rotate(15deg);
            border: 3px solid #28a745;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- Print Buttons -->
    <div class="print-buttons no-print">
        <button onclick="window.print()" class="btn btn-primary me-2">
            <i class="fas fa-print"></i> Print
        </button>
        <button onclick="downloadPDF()" class="btn btn-success me-2">
            <i class="fas fa-file-pdf"></i> Download PDF
        </button>
        <button onclick="window.close()" class="btn btn-secondary">
            <i class="fas fa-times"></i> Close
        </button>
    </div>

    <!-- Invoice Container -->
    <div class="invoice-container" id="invoice">

        <!-- Paid Badge (if applicable) -->
        @if (Model.PaymentStatus == "Paid")
        {
            <div class="badge-paid">PAID</div>
        }

        <!-- Header -->
        <div class="invoice-header">
            <div class="row">
                <div class="col-md-6">
                    <div class="company-logo">
                        <i class="fas fa-industry"></i> RMMS RICE MILL
                    </div>
                    <div>123 Mill Road, Rice Town</div>
                    <div>Phone: +91 1234567890</div>
                    <div>Email: info@rmmsricemill.com</div>
                    <div>GST: 29ABCDE1234F1Z5</div>
                </div>
                <div class="col-md-6 text-end">
                    <div class="invoice-title">INVOICE</div>
                </div>
            </div>
        </div>

        <!-- Invoice Details -->
        <div class="invoice-details">
            <div class="detail-row">
                <div class="detail-box">
                    <div class="detail-label">Bill To</div>
                    <div class="detail-value" style="font-size: 18px;">@Model.BuyerName</div>
                    <div class="mt-2">
                        @if (!string.IsNullOrEmpty(Model.BuyerAddress))
                        {
                            @Html.Raw(Model.BuyerAddress.Replace("\n", "<br>"))
                            <br />
                        }
                        @if (!string.IsNullOrEmpty(Model.BuyerGSTIN))
                        {
                            <text>GST: @Model.BuyerGSTIN</text>
                        }
                    </div>
                </div>
                <div class="detail-box text-end">
                    <div class="row mb-3">
                        <div class="col-6 text-end detail-label">Invoice Number:</div>
                        <div class="col-6 text-end detail-value">@Model.InvoiceNumber</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-6 text-end detail-label">Invoice Date:</div>
                        <div class="col-6 text-end detail-value">@Model.SaleDate.ToString("dd MMM yyyy")</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-6 text-end detail-label">Due Date:</div>
                        <div class="col-6 text-end detail-value">@(Model.DueDate?.ToString("dd MMM yyyy") ?? "N/A")</div>
                    </div>
                    <div class="row">
                        <div class="col-6 text-end detail-label">Payment Status:</div>
                        <div class="col-6 text-end detail-value">@(Model.PaymentStatus ?? "Pending")</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Invoice Items -->
        <div class="invoice-table">
            <table>
                <thead>
                    <tr>
                        <th style="width: 5%">#</th>
                        <th style="width: 40%">Product Description</th>
                        <th style="width: 15%" class="text-right">Quantity</th>
                        <th style="width: 15%" class="text-right">Rate</th>
                        <th style="width: 10%" class="text-right">GST %</th>
                        <th style="width: 15%" class="text-right">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>
                            <strong>@Model.RiceGrade</strong><br>
                            @if (!string.IsNullOrEmpty(Model.Remarks))
                            {
                                <small class="text-muted">@Model.Remarks</small>
                            }
                        </td>
                        <td class="text-right">@Model.Quantity.ToString("N2") kg</td>
                        <td class="text-right">₹@Model.UnitPrice.ToString("N2")</td>
                        <td class="text-right">5%</td>
                        <td class="text-right">₹@Model.TotalInvoiceValue.ToString("N2")</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Summary -->
        <div class="invoice-summary">
            <div class="summary-row">
                <div class="summary-label">Subtotal:</div>
                <div class="summary-value">₹@Model.TotalInvoiceValue.ToString("N2")</div>
            </div>
            @if (Model.Discount > 0)
            {
                <div class="summary-row">
                    <div class="summary-label">Discount:</div>
                    <div class="summary-value">- ₹@Model.Discount.ToString("N2")</div>
                </div>
            }
            <div class="summary-row">
                <div class="summary-label">Taxable Value:</div>
                <div class="summary-value">₹@Model.TaxableValue.ToString("N2")</div>
            </div>
            @if (Model.CGSTAmount > 0)
            {
                <div class="summary-row">
                    <div class="summary-label">CGST (2.5%):</div>
                    <div class="summary-value">₹@Model.CGSTAmount.ToString("N2")</div>
                </div>
                <div class="summary-row">
                    <div class="summary-label">SGST (2.5%):</div>
                    <div class="summary-value">₹@Model.SGSTAmount.ToString("N2")</div>
                </div>
            }
            @if (Model.IGSTAmount > 0)
            {
                <div class="summary-row">
                    <div class="summary-label">IGST (5%):</div>
                    <div class="summary-value">₹@Model.IGSTAmount.ToString("N2")</div>
                </div>
            }
            @if (Model.FreightCharges > 0)
            {
                <div class="summary-row">
                    <div class="summary-label">Freight Charges:</div>
                    <div class="summary-value">₹@Model.FreightCharges.ToString("N2")</div>
                </div>
            }
            @if (Model.OtherCharges > 0)
            {
                <div class="summary-row">
                    <div class="summary-label">Other Charges:</div>
                    <div class="summary-value">₹@Model.OtherCharges.ToString("N2")</div>
                </div>
            }
            <div class="summary-row total-row">
                <div class="summary-label">TOTAL AMOUNT:</div>
                <div class="summary-value">₹@Model.GrossInvoiceAmount.ToString("N2")</div>
            </div>
        </div>

        <!-- Footer -->
        <div class="invoice-footer">
            <div class="row">
                <div class="col-md-6">
                    <div class="footer-section">
                        <div class="footer-title">Payment Information</div>
                        <div><strong>Bank Name:</strong> State Bank of India</div>
                        <div><strong>Account Name:</strong> RMMS Rice Mill Pvt Ltd</div>
                        <div><strong>Account Number:</strong> 1234567890</div>
                        <div><strong>IFSC Code:</strong> SBIN0001234</div>
                        <div><strong>UPI ID:</strong> rmms@sbi</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="footer-section">
                        <div class="footer-title">Terms & Conditions</div>
                        <ol style="font-size: 12px; padding-left: 20px; margin: 0;">
                            <li>Payment due within 30 days of invoice date</li>
                            <li>Late payment subject to 2% monthly interest</li>
                            <li>Goods once sold will not be taken back</li>
                            <li>Subject to local jurisdiction only</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="mt-4 pt-4 border-top">
                <div class="row">
                    <div class="col-md-6">
                        <div style="font-size: 12px; color: #666;">
                            Generated on @DateTime.Now.ToString("dd MMM yyyy HH:mm")
                        </div>
                    </div>
                    <div class="col-md-6 text-end">
                        <div style="margin-top: 40px; border-top: 1px solid #333; display: inline-block; padding-top: 5px;">
                            <strong>Authorized Signature</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        function downloadPDF() {
            const { jsPDF } = window.jspdf;

            // Hide print buttons temporarily
            $('.print-buttons').hide();

            html2canvas(document.querySelector('#invoice'), {
                scale: 2
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                pdf.save('invoice-INV-2024-001.pdf');

                // Show print buttons again
                $('.print-buttons').show();
            });
        }
    </script>
</body>
</html>
