@model List<RMMS.Models.LoanAdvance>
@{
    ViewData["Title"] = "Loans & Advances";
    var totalGiven = Model?.Sum(x => x.AmountGiven) ?? 0;
    var totalRepaid = Model?.Sum(x => x.Repayment) ?? 0;
    var totalOutstanding = Model?.Sum(x => x.Balance) ?? 0;
    var outstandingCount = Model?.Count(x => x.Balance > 0) ?? 0;
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="ms-card ms-stat-card">
                <div class="ms-card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="ms-text-muted mb-2">Total Entries</h6>
                            <h3 class="ms-text-primary mb-0">@(Model?.Count ?? 0)</h3>
                        </div>
                        <div class="ms-stat-icon" style="background: #E3F2FD;">
                            <i class="fas fa-hand-holding-usd" style="color: #0078D4;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="ms-card ms-stat-card">
                <div class="ms-card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="ms-text-muted mb-2">Total Given</h6>
                            <h3 class="ms-text-danger mb-0">₹@totalGiven.ToString("N0")</h3>
                        </div>
                        <div class="ms-stat-icon" style="background: #FFEBEE;">
                            <i class="fas fa-arrow-up" style="color: #DC3545;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="ms-card ms-stat-card">
                <div class="ms-card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="ms-text-muted mb-2">Total Repaid</h6>
                            <h3 class="ms-text-success mb-0">₹@totalRepaid.ToString("N0")</h3>
                        </div>
                        <div class="ms-stat-icon" style="background: #E8F5E9;">
                            <i class="fas fa-arrow-down" style="color: #28A745;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="ms-card ms-stat-card">
                <div class="ms-card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="ms-text-muted mb-2">Outstanding</h6>
                            <h3 class="ms-text-warning mb-0">₹@totalOutstanding.ToString("N0")</h3>
                            <small class="ms-text-muted">@outstandingCount items</small>
                        </div>
                        <div class="ms-stat-icon" style="background: #FFF3E0;">
                            <i class="fas fa-clock" style="color: #FFC107;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="ms-card">
        <div class="ms-card-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h2 class="ms-card-title" style="margin: 0;">
                <i class="fas fa-hand-holding-usd"></i> Loans & Advances Register
            </h2>
            <div style="display: flex; gap: 8px;">
                <a asp-action="Create" class="ms-btn ms-btn-primary">
                    <i class="fas fa-plus"></i> New Loan/Advance
                </a>
            </div>
        </div>
        <div class="ms-card-body">
            @if (Model != null && Model.Any())
            {
                <div class="table-responsive">
                    <table class="ms-datatable table table-striped table-hover" data-export="true" data-page-length="25">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Voucher No</th>
                                <th>Particulars</th>
                                <th>Party/Employee</th>
                                <th>Amount Given</th>
                                <th>Repayment</th>
                                <th>Repayment Date</th>
                                <th>Balance</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.OrderByDescending(x => x.Date))
                            {
                                <tr>
                                    <td>@item.Date.ToString("dd-MMM-yyyy")</td>
                                    <td>@item.VoucherNumber</td>
                                    <td>@item.Particulars</td>
                                    <td>@item.PartyName</td>
                                    <td class="text-danger">₹ @item.AmountGiven.ToString("N2")</td>
                                    <td class="text-success">
                                        @(item.Repayment > 0 ? "₹ " + item.Repayment.ToString("N2") : "-")
                                    </td>
                                    <td>
                                        @(item.RepaymentDate.HasValue ? item.RepaymentDate.Value.ToString("dd-MMM-yyyy") : "-")
                                    </td>
                                    <td class="fw-bold">₹ @item.Balance.ToString("N2")</td>
                                    <td>
                                        @if (item.Balance == 0)
                                        {
                                            <span class="ms-badge ms-badge-success">Cleared</span>
                                        }
                                        else
                                        {
                                            <span class="ms-badge ms-badge-warning">Outstanding</span>
                                        }
                                    </td>
                                    <td>
                                        <div class="ms-action-buttons">
                                            @if (item.Balance > 0)
                                            {
                                                <a asp-action="RecordRepayment" asp-route-id="@item.Id" class="ms-action-btn ms-action-btn-success" title="Record Repayment">
                                                    <i class="fas fa-rupee-sign"></i>
                                                </a>
                                            }
                                            <a asp-action="Details" asp-route-id="@item.Id" class="ms-action-btn ms-action-btn-info" title="View Details">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info text-center">
                    <i class="fas fa-hand-holding-usd fa-3x mb-3"></i>
                    <h5>No Loans or Advances Recorded</h5>
                    <p>Track loans and advances given to employees or parties here.</p>
                    <a asp-action="Create" class="btn btn-primary">Record First Entry</a>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // DataTable initialization is handled by site-enhanced.js globally
    </script>
}